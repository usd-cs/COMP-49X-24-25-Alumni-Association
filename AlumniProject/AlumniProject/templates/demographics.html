<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instagram Demographics</title>
  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --founders-blue: #003b70;
      --immaculata-blue: #0074c8;
      --torero-blue: #75bee9;
      --alcala-white: #ffffff;
    }

    body {
      background: linear-gradient(135deg, #003b70, #0074c8);
      min-height: 100vh;
      color: white;
      margin: 0;
      padding: 0;
    }

    /* Navigation Tabs */
    .nav-tabs .nav-link {
      color: var(--alcala-white);
      background-color: transparent;
      border: none;
      font-size: 1.2rem; /* Increase the font size here to match index.html */
    }
    .nav-tabs .nav-link.active {
      color: var(--torero-blue);
      background-color: var(--alcala-white);
      border-radius: 5px 5px 0 0;
    }

    .container {
      background-color: var(--torero-blue);
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      margin-top: 20px;
      max-width: 1200px;
    }

    .btn {
      background-color: var(--founders-blue);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      margin: 5px;
    }
    .btn:hover {
      background-color: var(--immaculata-blue);
    }

    .list-group {
      max-height: 250px; /* Adjust as needed */
      overflow-y: auto;
      background: var(--alcala-white);
      border-radius: 10px;
      padding: 1rem;
      color: #000;
    }

    .section-heading {
      color: #000;
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.1rem;
      font-weight: 600;
    }

    /* Chart container for the histogram */
    .chart-container {
      background-color: var(--alcala-white);
      border-radius: 10px;
      margin-top: 20px;
      color: #000;
      padding: 10px;
      /* Restrict the chart's max width so it doesn't stretch too wide */
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    .chart-title {
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    .chart-container canvas {
      /* Let the width fill the container, keep aspect ratio for height */
      width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body>
  <!-- Navigation Tabs (same style as index.html) -->
  <nav class="nav nav-tabs justify-content-center">
    <!-- Link to home page (Post Info) via Django named URL or absolute path -->
    <a class="nav-link" href="{% url 'home' %}">Post Info</a>
    <!-- Account Info (still linking to an .html or your own Django URL) -->
    <a class="nav-link" href="account.html">Account Info</a>
    <!-- Active tab for Demographic Info -->
    <a class="nav-link active" aria-current="page" href="{% url 'demographics' %}">Demographic Info</a>
  </nav>

  <div class="container">
    <!-- (Optional) <h1>Instagram Demographics</h1> can be commented out if you prefer. -->

    <div class="text-center mb-3">
      <button class="btn" onclick="getDemographics()">Get Demographics</button>
    </div>

    <!-- Top row: two lists side by side -->
    <div class="row">
      <div class="col-md-6">
        <h2 class="section-heading">Top Interacted Countries</h2>
        <ul class="list-group" id="countryList"></ul>
      </div>
      <div class="col-md-6">
        <h2 class="section-heading">Top Interacted Cities</h2>
        <ul class="list-group" id="cityList"></ul>
      </div>
    </div>

    <!-- Single vertical histogram for Age Range -->
    <div class="chart-container">
      <h2 class="chart-title">Age Range Distribution</h2>
      <canvas id="ageHistogram"></canvas>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // In a real scenario, replace this with an API call to your server.
    // The data below is just a mock example.
    async function getDemographics() {
      try {
        // For production, you might use:
        // const response = await fetch("/api/demographics");
        // const data = await response.json();

        const data = {
          ageRanges: {
            "13-17": 50,
            "18-24": 150,
            "25-34": 200,
            "35-44": 100,
            "45-54": 60,
            "55+": 40
          },
          topCountries: [
            { country: "United States", count: 120 },
            { country: "Canada", count: 80 },
            { country: "Brazil", count: 70 },
            { country: "Germany", count: 50 },
            { country: "Japan", count: 30 }
          ],
          topCities: [
            { city: "New York", count: 60 },
            { city: "Toronto", count: 40 },
            { city: "Sao Paulo", count: 35 },
            { city: "Berlin", count: 25 },
            { city: "Tokyo", count: 20 }
          ]
        };

        // Render everything
        renderAgeHistogram(data.ageRanges);
        renderCountryList(data.topCountries);
        renderCityList(data.topCities);
      } catch (error) {
        console.error("Error fetching demographics:", error);
        alert("Unable to fetch demographics data.");
      }
    }

    // Renders vertical bar chart for Age Range
    function renderAgeHistogram(ageData) {
      const ctx = document.getElementById("ageHistogram").getContext("2d");
      const labels = Object.keys(ageData);
      const values = Object.values(ageData);

      new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              // No 'label' property, so no legend is displayed
              data: values,
              backgroundColor: "rgba(0, 59, 112, 0.7)",
              borderColor: "rgba(0, 59, 112, 1)",
              borderWidth: 1,
              borderRadius: 5
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false // Hide legend entirely
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: "Users"
              }
            },
            x: {
              title: {
                display: true,
                text: "Age Range"
              }
            }
          }
        }
      });
    }

    // Render the Top Interacted Countries list
    function renderCountryList(countries) {
      const countryList = document.getElementById("countryList");
      countryList.innerHTML = "";
      countries.forEach((item) => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.textContent = item.country;

        const badge = document.createElement("span");
        badge.className = "badge bg-primary rounded-pill";
        badge.textContent = item.count;
        li.appendChild(badge);

        countryList.appendChild(li);
      });
    }

    // Render the Top Interacted Cities list
    function renderCityList(cities) {
      const cityList = document.getElementById("cityList");
      cityList.innerHTML = "";
      cities.forEach((item) => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.textContent = item.city;

        const badge = document.createElement("span");
        badge.className = "badge bg-primary rounded-pill";
        badge.textContent = item.count;
        li.appendChild(badge);

        cityList.appendChild(li);
      });
    }
  </script>
</body>
</html>
